{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- Page Title -->
    <title>African Translator</title>

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/png" href={% static "assets/images/logo/favicon2.png" %}>

    <!-- CSS Files -->
    <link rel="stylesheet" href={% static "assets/css/animate-3.7.0.css" %}>
    <link rel="stylesheet" href={% static "assets/css/font-awesome-4.7.0.min.css" %}>
    <link rel="stylesheet" href={% static "assets/css/bootstrap-4.1.3.min.css" %}>
    <link rel="stylesheet" href={% static "assets/css/owl-carousel.min.css" %}>
    <link rel="stylesheet" href={% static "assets/css/jquery.datetimepicker.min.css" %}>
    <link rel="stylesheet" href={% static "assets/css/style.css" %}>
    <style>
        /*
        @media (min-width: 1200){
            .naby{
                padding-left: 200px;
            }
        }
        //*/
        .nnaby{
            width:100%;
            top:150px;
            padding-right:15px;
            padding-left:300px;
            margin-right:auto;
            margin-left:auto;
            position: fixed;
        }
        
        .naby{
            position: fixed;
            width:100%;
            top:150px;
            padding-right:15px;
            padding-left:300px;
            margin-right:auto;
            margin-left:auto;
            
            padding: 10px 10px;
            text-align: center;
            
        }
       

        /* .naby{
            width:100%;
            top:150px;
            padding-right:15px;
            padding-left:85px;
            margin-right:auto;
            margin-left:auto;
            position: fixed;
        } */
        
        .button-centre{
            margin: 10px 10px;
            padding: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Preloader Starts -->
    <div class="preloader">
        <div class="spinner"></div>
    </div>
    <!-- Preloader End -->

    <!-- Header Area Starts -->
	<header class="header-area">
        <div class="container">
            <div class="row">
                <div class="col-lg-2">
                    <div class="logo-area">
                        <a href="index.html"><img src={% static "assets/images/logo/logo4.png" %} alt="logo"></a>
                    </div>
                </div>
                <div class="col-lg-10">
                    <div class="custom-navbar">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>  
                    <div class="main-menu">
                        <ul>
                            <li class="active"><a href="/">Accueil</a></li>
                            <li><a href="/about">A propos</a></li>
                            <li><a href="/menu">Langues</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Header Area End -->

    <!-- Banner Area Starts -->
    <section class="banner-area">
        <div class="naby">
            <table>
                <thead>
                    <tr>
                        <th class="text-left">
                            <div class="dropdown show">
                                <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink_1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Langue
                                </a>
                                
                                <div class="dropdown-menu"  aria-labelledby="dropdownMenuLink">
                                    {% for langue in langues %}
                                        <a class="dropdown-item" href="#" onclick="spread_input(this)">{{langue}}</a>  
                                    {% endfor %}
                                </div>
                            </div>
                        </th>
                        <th class="text-left">
                            <div class="dropdown show">
                                <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink_2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Langue
                                </a>      
                                <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                    {% for langue in langues %}
                                        <a class="dropdown-item" href="#" onclick="spread_target(this)">{{langue}}</a>  
                                    {% endfor %}
                                </div>
                            </div>
                        </th>
                    </tr>
                </thead>
            </table>
            <textarea name="message" id="texte_depart" onchange="traduction()" placeholder="Texte à traduire..."></textarea>
            <textarea name="message" id="texte_arrivé" placeholder="Traduction..." readonly="true"></textarea>
        </div>
    </section>
    
    <!-- Banner Area End -->

    <!-- Footer Area Starts -->
    <footer class="footer-area">
        <div class="footer-copyright">
            <div class="container">
                <div class="row">
                    <div class="col-lg-7 col-md-6">
                        <span><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright 2020 All rights reserved | This is made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="http://wa.me" target="_blank">NANDA && TIKENG</a></span>
                    </div>
                    <div class="col-lg-5 col-md-6">
                        <div class="social-icons">
                            <ul>
                                <li class="no-margin">Follow Us</li>
                                <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                                <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                                <li><a href="#"><i class="fa fa-google-plus"></i></a></li>
                                <li><a href="#"><i class="fa fa-pinterest"></i></a></li>
                                <li><a href="#"><i class="fa fa-instagram"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer Area End -->


    <!-- Javascript -->
    <script src={% static "assets/js/vendor/jquery-2.2.4.min.js" %}></script>
    <script src={% static "js/bootstrap/popper.min.js" %}></script>
	<script src={% static "js/bootstrap/bootstrap.min.js" %}></script>
    <script src={% static "assets/js/vendor/wow.min.js" %}></script>
    <script src={% static "assets/js/vendor/owl-carousel.min.js" %}></script>
    <script src={% static "assets/js/vendor/jquery.datetimepicker.full.min.js" %}></script>
    <script src={% static "assets/js/vendor/jquery.nice-select.min.js" %}></script>
    <script src={% static "assets/js/vendor/traduction.js" %}></script>
    <script src={% static "assets/js/main.js" %}></script>
    <script>  
        var langues = {{langues|safe}}
        var input_language, target_language, current_text = ""

        $(document).ready(function(){
            input_language = langues[0]
            target_language = langues[2]
            document.getElementById('dropdownMenuLink_1').innerText = input_language
            document.getElementById('dropdownMenuLink_2').innerText = target_language
            // informer le serveur
            spread()

            $("#texte_depart").change(function(){
                text = $("#texte_depart").val()
                if (text != current_text){
                    current_text = text
                    submission()
                }
            });

            var intervalID = window.setInterval(function(){
                $("#texte_depart").blur();
                $("#texte_depart").focus();
            }, 
            1000);
        });

        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != "") {
                var cookies = document.cookie.split(";");
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == name + "=") {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        $.ajaxSetup({
            headers: { "X-CSRFToken": getCookie("csrftoken") }
        });

        function spread_input(target){
            document.getElementById('dropdownMenuLink_1').innerText = target.innerText
            input_language = target.innerText
            spread()
            // enlever la langue choisie dans les langues de sortie
        }

        function spread_target(target){
            document.getElementById('dropdownMenuLink_2').innerText = target.innerText
            target_language = target.innerText
            spread()
            // enlever la langue choisie dans les langues d'entrée
        }

        function spread(){
            // Prévenir pour le changement de langues
            $.ajax({
                type: "POST",
                url: "lang", 
                dataType: "json",
                traditional: true,
                data: {
                    'target_language':target_language,
                    'input_language':input_language
                },
                success: function(data) {
                    // Langues trouvées
                    console.log(data);
                    // Rétraduire le texte s'il en existait un
                    submission();
                },
                error:function(error) {
                    //Langues non trouvées
                    console.log('error', error.statusCode());
                }
            });
        }

        function submission(){
            $.ajax({
                type: "POST",
                url: "ts", 
                dataType: "json",
                traditional: true,
                data: {'text': current_text },
                success: function(data) {
                    // Traduction OK
                    $("#texte_arrivé").val(data['text'])
                },
                error:function(error) {
                    // Traduction NON OK
                    console.log('error', error.statusCode());
                }
            });
        }
    </script>
    
</body>
</html>
